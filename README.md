# ЦИФРОВОЙ АССИСТЕНТ СИСТЕМЫ ГЕОМОНИТОРИНГА

#### Алексей Алексеевич ЦУКАНОВ (c) 2024
#### alexey@tsukanoff.ru

## Цель:
Разработать и реализовать программный комплекс 
«Цифровой ассистент системы геомониторинга» для использования в центрах геомониторинга
(метеорологических, экологических, геофизических и пр.), упрощающий работу 
с регистрирующими приборами и обмен данными при проведении полевого этапа 
работ, а также взаимодействие специалистов полевого отряда между собой и с 
координационным центром.

## Использованные библиотеки, *фреймворки* и технологии

    Tkinter, Telegram, SQLite, Pandas, Threading, API статических карт Яндекса 

Разработанный программный комплекс состоит из двух связанных между собой программ: основное
*desktop*-приложение с графическим интерфейсом, 
реализованное с помощью библиотеки **tkinter** и telegram-бот, реализованный
с использованием библиотеки **aiogram** версии 2.25.2. 
Основной язык программирования **Python 3** (использовалась версия 3.9), 
базы данных реализованы с использованием **SQLite 3**.
В работе с исходными данными в формате xlsx-файлов применялась библиотека **pandas** 
в связке с **openpyxl**. 

Для обмена основными данными между *desktop*-приложением и
telegram-ботом использовались базы данных, вспомогательные параметры передавались при
запуске telegram-бота с использованием возможностей *упаковки-распаковки* библиотеки **json**. 
После загрузки необходимых данных и формирования *проекта-задания* из основного приложения
выполняется запуск telegram-бота в параллельном потоке с передачей необходимых параметров.


## ОПИСАНИЕ

## Краткое описание баз данных

В проекте создаются и используются 2 базы данных, которые располагаются в папке **databases/**:

    - users.db содержит 2 таблицы: Users, Admins
    - project.db содержит 2 таблицы: Points, Devices

Таблица Users содержит данные о полевых специалистах, который выполняют расстановку приборов 
согласно проектному заданию. 
В таблице Admins содержаться необходимые данные о координаторах проекта.

База данных **project.db** обновляется при формировании задания полевых работ на день,
в таблицу **Points** заносится список уникальных названий точек (и их координаты), рядом с которыми
необходимо установить прибор. В таблицу **Devices** записывается список ID приборов, эта
таблица служит вспомогательной, позволяя во время установки приборов вести учет комплектов.

Работа с ними осуществляется через библиотеку sqlite3, crud-функции прописаны в 
python-модуле проекта **database.py**.

Формально к базам данных можно отнести также и статическую таблицу с описанием 
***приборной базы***, которая используется только для чтения и располагается в проекте
в директории **tables/** в формате xlsx-файла (сейчас это файл: DevicesInfo.xlsx).

## Описание хода работ при использовании программы

Cпециалисты из группы Admins с использованием основного *desktop*-программы создают *Задание* 
на день, которое включает в себя таблицу точек, содержащую плановые (не фактические) 
координаты точек (в системе WGS84), список названий точек и рекомендуемую для 
использования группу приборов (выбираются по названию группы GroupID из таблицы Devices). 

Кроме того, формируется описание проекта / задания, и с помощью ***API статических карт 
Яндекса*** генерируется карта территории с расположениями этих точек.

*Задание* при запуске telegram-бота из основного *desktop*-приложения становиться доступно
полевым специалистам со смартфона или планшета (необходим аккаунт в Telegram, наличие в устройстве
модуля GPS | ГЛОНАСС, доступ в интернет).

Функционал telegram-бота позволяет выйти со смартфоном на точку, выбрать ее имя из меню, 
просмотреть и выбрать тип прибора, установить его и затем, нажав на кнопку, 
зарегистрировать на сервере данные об установке прибора, включая название точки, 
уникальное ID прибора, время установки, фактические координаты в WGS84 и уникальное 
ID специалиста, выполнившего постановку измерительной аппаратуры.

В процессе работы функционал telegram-бота позволяет просмотреть актуальную информацию
об установленных приборах, оставшихся точках, участниках полевого отряда и много другое.
Имеется возможность посмотреть информацию о приборной базе, включая изображение приборов,
описание и ссылки на сайт производителя. Также есть возможность просмотреть краткую
инструкцию о работе telegram-бота, связаться с разработчиком и координационным центром.
Функционал telegram-бота дает возможность вывести свои координаты на экран и 
открыть свою геопозицию на web-картах (сейчас реализована поддержка 4 сервисов через 
формирование URL-запросов в **Яндекс**-карты, **OpenStreetMap** (**OSM**), **Google maps** и 
сайт **nakarte.me**).

В конце полевого дня, специалисты снова возвращаются на точки и, отключая/собирая аппаратуру, 
также через функционал telegram-бота отправляют данные об окончании регистрации
-- сервер пишет отправляемые ему данные, как об установке так и снятии приборов, 
включая данные о времени, фактических координатах и о том, кто именно произвел 
работы на каждой конкретной точке. 
Формируются данные для полевого журнала и блока в отчет.


## Структура проекта

Файловая структура проекта представлена на ***Рис.0.***: основное приложение (входная точка) 
пакета программ находится в модуле **app.py**, в нем 

![структура папок проекта](https://github.com/user-attachments/assets/2946d074-9c95-4a94-a0d8-4d296b4730b0)
***Рис.0.*** *Структура каталогов проекта.*


## Работа с tkinter-модулем приложения "Цифровой ассистент системы геомониторнга"

### Работа с основным функционалом на примере проекта "10 вершин Кавказских гор"

![01](https://github.com/user-attachments/assets/0d69b340-7787-408a-a643-389338727f15)

***Рис.1.***

Начальное (основное) окно *desktop*-модуля программы "Цифровой ассистент системы геомониторнга" версии 0.0.1 показано на ***Рис.1***. 
Для демнстрации работы с программой был сделан тестовый проект *"10 вершин Кавказских гор"*. 
Исходные данные представляют собой таблицу, содержащую 10 точек в координатной системе WGS84 с формальными именами точек P01, ..., P10 
(каждая точка соответствует положению одного из пиков Кавказа из списка топ-10 по высоте).
Далее будем назвать эту таблицу *таблицей точек*.

![02](https://github.com/user-attachments/assets/44c86136-4f68-407c-bbc4-2880cf4e5d3d)

***Рис.2.***

Для загрузки 

![03](https://github.com/user-attachments/assets/3d3a5715-6406-4f23-85e0-0600219d5d37)

***Рис.3.***


![04](https://github.com/user-attachments/assets/f3adaf88-544f-4dcf-83ba-4667c7879b55)

***Рис.4.***


![05](https://github.com/user-attachments/assets/bbf5cbcb-cde4-47ad-84f8-afd1266486c8)

***Рис.5.***


![06](https://github.com/user-attachments/assets/e65e06d6-0e4e-4197-98c3-b6e032078292)

***Рис.6.***


![07](https://github.com/user-attachments/assets/5a7788f3-cc6c-4512-afe9-6c182f4a568e)

***Рис.7.***


![08](https://github.com/user-attachments/assets/eba70359-6113-47c6-b1a5-770a4c49e960)

***Рис.8.***


![09](https://github.com/user-attachments/assets/bd7c64f3-3bb3-4071-b249-6d097e31934e)

***Рис.9.***


![10](https://github.com/user-attachments/assets/85aa92f5-3021-4ef9-b6e2-e48f257dee03)

***Рис.10.***



![11](https://github.com/user-attachments/assets/8b4361e8-d51c-4bf8-9ff0-c79d86017e87)

***Рис.11.***



![12](https://github.com/user-attachments/assets/a60bfb00-8aef-4bfe-a586-9c718c0394c6)

***Рис.12.***



![13](https://github.com/user-attachments/assets/beac653e-a00b-499e-bfb7-6deea9bf2a3f)

***Рис.13.***



### Второстепенные пункты меню программы
![A1](https://github.com/user-attachments/assets/5440f0dc-9cae-4152-bc6e-36ae6c97f310)

***Рис.П1.***


![A2](https://github.com/user-attachments/assets/9006d253-124d-4aea-8a02-271bc8a8e6d5)

***Рис.П2.***


![A3](https://github.com/user-attachments/assets/ebaf3075-944d-43da-ab06-1fd17943e679)

***Рис.П3.***


![A4](https://github.com/user-attachments/assets/84e06f85-240f-4fd4-9619-a7efcb3c800a)

***Рис.П4.***



## Пример работы с telegram-ботом пакета "Цифровой ассистент системы геомониторнга"



![01](https://github.com/user-attachments/assets/ca649a0f-289c-45e3-8816-c5123a21e43f)
![02](https://github.com/user-attachments/assets/ba351083-ea1c-470d-8be2-6f6e9307bf55)

![03](https://github.com/user-attachments/assets/c37e2c43-e95b-4032-87a3-fe3ec2c79fb0)
![04](https://github.com/user-attachments/assets/881e0871-1e48-4131-8387-4d7f5b29652f)

![05](https://github.com/user-attachments/assets/02f04d73-b1a0-4096-9823-953d85e88534)
![06](https://github.com/user-attachments/assets/1915f614-520e-4768-a0b7-ef40ad8984e4)

![07](https://github.com/user-attachments/assets/772df49b-4014-4a8f-9b3f-5669795a5dad)

![08](https://github.com/user-attachments/assets/ef780607-6f75-46c3-81bc-268af376e854)

![09](https://github.com/user-attachments/assets/0e6f307b-2550-4065-9b0d-27b35cd20e64)

![10](https://github.com/user-attachments/assets/032c2182-a823-4a8d-bea6-da3e90816ddf)

![11](https://github.com/user-attachments/assets/525ea1d6-8960-4689-9fbf-a2715e75823b)

![12](https://github.com/user-attachments/assets/01d0c716-157d-42df-a778-441c5cd98652)

![13](https://github.com/user-attachments/assets/5cb06235-7e57-49bd-b772-eaf67f313394)

![14](https://github.com/user-attachments/assets/0e79ea83-d44f-417d-a609-0e2cf5532c47)

![15](https://github.com/user-attachments/assets/998901ac-e1d9-4887-aff4-c4a2709d6866)

![16](https://github.com/user-attachments/assets/1edaf108-9623-4230-9565-819281e03487)

![18](https://github.com/user-attachments/assets/3845eff8-b748-497c-9af8-52027bed06ba)

![19](https://github.com/user-attachments/assets/b5ae9de8-f518-42a3-bce9-e57bd691e744)

![20](https://github.com/user-attachments/assets/e9c4fa85-09d7-47c3-a918-b2f2b38089bf)

![21](https://github.com/user-attachments/assets/55c9d47c-fb10-4838-889a-91ad3c931258)

![22](https://github.com/user-attachments/assets/1c344276-9e41-4128-b17d-77ea91754403)





